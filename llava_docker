# Use an official Python runtime as a parent image
FROM pytorch/pytorch:2.1.2-cuda12.1-cudnn8-devel

# Set environment variables
ENV PYTHONUNBUFFERED 1

RUN apt-get update && apt-get install -y python3 python3-pip sudo

# Set working directory in the container
WORKDIR /app

# Copy the current directory (project files) contents into the container at /app
COPY . /app

# inside the project directory
RUN cd /app

# Install system dependencies
# RUN apt-get update && apt-get install -y \
#     # Add any system dependencies here if needed \
#     && rm -rf /var/lib/apt/lists/*

# Create a virtual environment and install dependencies
# RUN python3.10 -m venv /opt/venv
# ENV PATH="/opt/venv/bin:$PATH"

# Install Python dependencies
# Upgrade pip and install the dependencies

RUN pip install --no-cache-dir --upgrade pip
RUN pip install --no-cache-dir wheel
RUN pip install --no-cache-dir -e . 
RUN pip install --no-cache-dir -e ".[train]" 
RUN pip install flash-attn --no-build-isolation --no-cache-dir

# Command to run your application
# CMD [ "python", "your_main_script.py" ]
